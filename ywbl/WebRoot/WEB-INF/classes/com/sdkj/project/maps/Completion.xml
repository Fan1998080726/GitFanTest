<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://www.ibatis.com/dtd/sql-map-2.dtd">

<sqlMap namespace ="Completeapply" > 

   	<typeAlias alias ="completeapply" type ="com.sdkj.project.vo.CompleteApply"/> 
   
   	<insert id="addcompletion" parameterClass="completeapply">

			insert into complete_apply(pro_id,ca_date,ca_user,ca_remark,ca_flag)
            values (#pro_id#,now(),#ca_user#,#ca_remark#,#ca_flag#)

			<selectKey resultClass="int" keyProperty="ca_id">
			SELECT LAST_INSERT_ID()
			</selectKey>
	</insert>
	
	<insert id="addcompletionprofile" parameterClass="java.util.HashMap">
			insert into complete_apply_file (ca_id,caf_name,caf_url)
			   values(#ca_id#,#caf_name#,#caf_url#)
	</insert>
	
	<select id="compcount" resultClass="int" parameterClass="int">
			select 
              count(*)
			from complete_apply  where pro_id = #pro_id#
	</select>
	
	
	<select id="showcompletionpro" resultClass="completeapply" parameterClass="int">
			select 
				ca_id,
				pro_id,
				ca_date,
				ca_user,
				ca_remark,
				ca_flag
			from complete_apply  where pro_id = #pro_id#
	</select>
	
	
		<select id="showcompletionfile" resultClass="java.util.HashMap" parameterClass="int">
			select 
				caf_id,
				ca_id,
				caf_name,
				caf_url
			from complete_apply_file  where ca_id = #ca_id#
	</select>
	
	
	
	<delete id="deletecompletionfile" parameterClass="int">
			delete 
			FROM
				complete_apply_file
			WHERE
				ca_id = #ca_id#
	</delete>
	
	<delete id="deletecompletionpro" parameterClass="int">
	    delete 
			FROM
				complete_apply
			WHERE
				pro_id = #pro_id#
	</delete>

</sqlMap > 
